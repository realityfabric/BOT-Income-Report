-- Enter the desired Fiscal Year (e.g. if the fiscal year starts in 2022 and ends in 2023 then @FY = '2023'
DECLARE @FY CHAR(4)
SELECT @FY = '2024'

-- Enter the desired Fiscal Period
-- FM: 1  = July
-- FM: 2  = August
-- FM: 3  = September
-- FM: 4  = October
-- FM: 5  = November
-- FM: 6  = December 
-- FM: 7 = Jan
-- FM: 8 = Feb
-- FM: 9 = Mar
-- FM: 10 = Apr
-- FM: 12 = June
DECLARE @MAX_FM INT
SELECT @MAX_FM = 9

DECLARE @LEDGER VARCHAR(10)
SELECT @LEDGER = 'LOCAL'

DROP TABLE IF EXISTS #PS_LEDGER_W_SRECNP_DESCR
SELECT *
INTO #PS_LEDGER_W_SRECNP_DESCR
FROM (
SELECT 
	CASE

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4000010 AND 4000199 THEN 'Line 01 - Op Rev'

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4010010 AND 4010019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4010020 AND 4010029 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030030 AND 4030039 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030020 AND 4030029 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030055 AND 4030059 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4130010 AND 4130019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030040 AND 4030054 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030060 AND 4030069 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030070 AND 4030079 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030010 AND 4030019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030080 AND 4030019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales' -- This line will never calculate anything
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030125 AND 4030139 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030160 AND 4030189 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4040020 AND 4040019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Line 02 - Op Rev - Auxiliary Enterprise Sales'

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4020010 AND 4020129 THEN 'Line 03 - Op Rev - State and Local Grants and Contracts'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4021010 AND 4021039 THEN 'Line 03 - Op Rev - State and Local Grants and Contracts'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4021050 AND 4021089 THEN 'Line 03 - Op Rev - State and Local Grants and Contracts'

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4022010 AND 4022999 
			AND PS_Ledger.DEPTID <> '41605' -- Exclude PEL
			THEN 'Line 04 - Op Rev - Federal Grants and Contracts'

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4010010 AND 4010029 THEN 'Line 05 - Op Rev - Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030010 AND 4030119 THEN 'Line 05 - Op Rev - Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030125 AND 4030139 THEN 'Line 05 - Op Rev - Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030160 AND 4030199 THEN 'Line 05 - Op Rev - Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4040010 AND 4040119 THEN 'Line 05 - Op Rev - Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4130010 AND 4130099 THEN 'Line 05 - Op Rev - Other Operating Revenues'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4050010 AND 4050099 THEN 'Line 06 - Op Rev - Interest on Loans to Students'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5000010 AND 5000199 THEN 'Line 07 - Op Exp - Salaries and Wages'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5010010 AND 5010199 THEN 'Line 08 - Op Exp - Benefits'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5020010 AND 5020019 THEN 'Line 09 - Op Exp - Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5020023 AND 5020499 THEN 'Line 09 - Op Exp - Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050010 AND 5050018 THEN 'Line 09 - Op Exp - Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050021 AND 5050022 THEN 'Line 09 - Op Exp - Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081395 AND 5081399 THEN 'Line 09 - Op Exp - Scholarships and Fellowships'
		
		-- Includes COGS from 500 funds
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030010 AND 5030019 THEN 'Line 10 - Op Exp - Supplies and Materials'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030120 AND 5030299 THEN 'Line 10 - Op Exp - Supplies and Materials'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070010 AND 5070029 THEN 'Line 11 - Op Exp - Depreciation and Amortization'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070040 AND 5070079 THEN 'Line 11 - Op Exp - Depreciation and Amortization'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) = 5050020  THEN 'Line 12 - Op Exp - Purchased Services'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050023 AND 5050069  THEN 'Line 12 - Op Exp - Purchased Services'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050100 AND 5050169  THEN 'Line 12 - Op Exp - Purchased Services'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5060010 AND 5060099  THEN 'Line 13 - Op Exp - Utilities'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5020020 AND 5020022  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081010 AND 5081080  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030070 AND 5030119  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050070 AND 5050099  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5080010 AND 5080099  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081100 AND 5081109  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081110 AND 5081119  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030020 AND 5030069  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050170 AND 5050199  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081090 AND 5081099  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081120 AND 5081229  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081260 AND 5081279  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081230 AND 5081239  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081240 AND 5081249  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081250 AND 5081259  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) = 4010020 AND PS_Ledger.FUND_CODE LIKE '4__' THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4020010 AND 4020129 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4021010 AND 4021089 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4022010 AND 4022399 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030010 AND 4030189 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4040010 AND 4040119 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4120010 AND 4120099 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Line 14 - Op Exp - Operating Expenses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4130010 AND 4130099 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Line 14 - Op Exp - Operating Expenses'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4100010 AND 4100099  THEN 'Line 15 - NO Rev - State Appropriations'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4110020 AND 4110029  
			OR (
				PS_LEDGER.DEPTID = '41605' 
				AND SUBSTRING(PS_LEDGER.ACCOUNT, 1,1
			) = '4')
			THEN 'Line 16 - NO Rev - Federal PELL Grant Revenue'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030120 AND 4030124 THEN 'Line 17 - NO Rev - Investment Income, Gains and Losses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4120010 AND 4120099  THEN 'Line 17 - NO Rev - Investment Income, Gains and Losses'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5120010 AND 5120019  THEN 'Line 18 - NO Exp - Building Fee'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5120020 AND 5120029  THEN 'Line 19 - NO Exp - Innovation Fee'

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070030 AND 5070039  THEN 'Line 20 - NO Exp - Interest on Indebtedness'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070080 AND 5070089  THEN 'Line 20 - NO Exp - Interest on Indebtedness'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5110020 AND 5110029  THEN 'Line 20 - NO Exp - Interest on Indebtedness'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5110040 AND 5110099  THEN 'Line 20 - NO Exp - Interest on Indebtedness'

	END Category
	, 
	CASE

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4000010 AND 4000199 THEN 'Tuition and Fees'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4010010 AND 4010019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Room & Board'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4010020 AND 4010029 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Enter Sales'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030030 AND 4030039 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Fines & Forfeits'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030020 AND 4030029 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Income from Property'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030055 AND 4030059 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Sales of Assets'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4130010 AND 4130019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Sales of Assets'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030040 AND 4030054 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Sales of Property'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030060 AND 4030069 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Charges for Services'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030070 AND 4030079 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Indirect Cost Reimbursement'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030010 AND 4030019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Other Revenue'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030080 AND 4030019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Other Revenue' -- This line will never calculate anything
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030125 AND 4030139 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Other Revenue'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030160 AND 4030189 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'Other Revenue'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4040020 AND 4040019 AND PS_Ledger.FUND_CODE LIKE '5__' THEN 'COP Proceeds'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4020010 AND 4020129 THEN 'State and Local Grants and Contracts' 
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4021010 AND 4021039 THEN 'State and Local Grants and Contracts'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4021050 AND 4021089 THEN 'State and Local Grants and Contracts'
	
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4022010 AND 4022999
			AND PS_Ledger.DEPTID <> '41605' -- Exclude PELL
			AND PS_LEDGER.PRODUCT NOT IN ('CRS','CRI') -- Exclude CARES
			THEN 'Federal Grants and Contracts'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4010010 AND 4010029 THEN 'Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030010 AND 4030119 THEN 'Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030125 AND 4030139 THEN 'Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030160 AND 4030199 THEN 'Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4040010 AND 4040119 THEN 'Other Operating Revenues'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4010010 AND 4010029 THEN 'Other Operating Revenues'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4050010 AND 4050099 THEN 'Interest on Loans to Students'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5000010 AND 5000199 THEN 'Salaries and Wages'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5010010 AND 5010199 THEN 'Benefits'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5020010 AND 5020019 THEN 'Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5020023 AND 5020499 THEN 'Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050010 AND 5050018 THEN 'Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050021 AND 5050022 THEN 'Scholarships and Fellowships'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081395 AND 5081399 THEN 'Scholarships and Fellowships'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030010 AND 5030019 THEN 'Supplies and Materials'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030120 AND 5030299 THEN 'Supplies and Materials'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070010 AND 5070029 THEN 'Depreciation and Amortization'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070040 AND 5070079 THEN 'Depreciation and Amortization'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) = 5050020  THEN 'Purchased Services'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050023 AND 5050069  THEN 'Purchased Services'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050100 AND 5050169  THEN 'Purchased Services'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5060010 AND 5060099  THEN 'Utilities'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5020020 AND 5020022  THEN 'Transfers'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081010 AND 5081080  THEN 'Transfers'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030070 AND 5030119  THEN 'Non-Cap Equipment'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050070 AND 5050099  THEN 'Bank Fees'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5080010 AND 5080099  THEN 'Travel'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081100 AND 5081109  THEN 'Training'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081110 AND 5081119  THEN 'Equipment Rental'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5030020 AND 5030069  THEN 'Other Misc'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5050170 AND 5050199  THEN 'Other Misc'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081090 AND 5081099  THEN 'Other Misc'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081120 AND 5081229  THEN 'Other Misc'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081260 AND 5081279  THEN 'Other Misc'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081230 AND 5081239  THEN 'Software Maintenance'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081240 AND 5081249  THEN 'Rents & Leases'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5081250 AND 5081259  THEN 'Repair and Maintenance'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) = 4010020 AND PS_Ledger.FUND_CODE LIKE '4__' THEN 'Int Service Rev'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4020010 AND 4020129 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Int Service Rev'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4021010 AND 4021089 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Int Service Rev'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4022010 AND 4022399 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Int Service Rev'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030010 AND 4030189 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Int Service Rev'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4040010 AND 4040119 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Int Service Rev'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4120010 AND 4120099 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Int Service Rev'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4130010 AND 4130099 AND PS_Ledger.FUND_CODE LIKE '4__'  THEN 'Int Service Rev'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4100010 AND 4100099  THEN 'State Appropriations'
		
		WHEN  CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4110020 AND 4110029  
			OR (
				PS_LEDGER.DEPTID = '41605' 
				AND SUBSTRING(PS_LEDGER.ACCOUNT, 1,1
			) = '4')
			THEN 'Federal PELL Grant Revenue'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4110030 AND 4110099  
			OR (PS_Ledger.PRODUCT IN ('CRS', 'CRI') AND SUBSTRING(PS_Ledger.ACCOUNT,1,1) = '4')
			THEN 'Federal Non-Operating Revenue'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4030120 AND 4030124  THEN 'Investment Income, Gains and Losses'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4120010 AND 4120099  THEN 'Investment Income, Gains and Losses'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5120010 AND 5120019  THEN 'Building Fee Remit'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5120020 AND 5120029  THEN 'Innovation Fee Remit'
		
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070030 AND 5070039  THEN 'Interest on Indebtedness'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5070080 AND 5070089  THEN 'Interest on Indebtedness'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5110020 AND 5110029  THEN 'Interest on Indebtedness'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 5110040 AND 5110099  THEN 'Interest on Indebtedness'
	END [Sub-Category]
	, PS_Ledger.FUND_CODE
	, PS_LEDGER.PRODUCT
	, PS_LEDGER.CLASS_FLD
	, PS_LEDGER.DEPTID
	, PS_LEDGER.ACCOUNT
	, PS_LEDGER.FISCAL_YEAR
	, PS_LEDGER.ACCOUNTING_PERIOD
	, PS_LEDGER.POSTED_TOTAL_AMT
	, PS_LEDGER.LEDGER
	, PS_Ledger.DTTM_STAMP_SEC
FROM ctcLink_ODS.SYSADM_FIN.PS_LEDGER PS_Ledger
WHERE (FISCAL_YEAR = @FY OR FISCAL_YEAR = @FY - 1) AND LEDGER = @LEDGER
	AND ACCOUNTING_PERIOD <= @MAX_FM

UNION

SELECT
	CASE
		WHEN PS_Ledger.FUND_CODE = '060' AND LEN(PRODUCT) = 0 AND PS_Ledger.ACCOUNT LIKE '4100050' THEN 'Line 18 - NO Exp - Building Fee' -- TODO look at this again with amanda
	    WHEN PS_Ledger.FUND_CODE = '561' AND PS_Ledger.ACCOUNT LIKE '4______' THEN 'Line 19 - NO Exp - Innovation Fee'
	END [Category]
	, CASE
		WHEN PS_Ledger.FUND_CODE = '060' AND LEN(PRODUCT) = 0  AND PS_Ledger.ACCOUNT LIKE '4100050' THEN 'Line 18 - NO Exp - Building Fee'
	    WHEN PS_Ledger.FUND_CODE = '561' AND PS_Ledger.ACCOUNT LIKE '4______' THEN 'Line 19 - NO Exp - Innovation Fee'
	END [Sub-Category]
	, PS_Ledger.FUND_CODE
	, PS_LEDGER.PRODUCT
	, PS_LEDGER.CLASS_FLD
	, PS_LEDGER.DEPTID
	, PS_LEDGER.ACCOUNT
	, PS_LEDGER.FISCAL_YEAR
	, PS_LEDGER.ACCOUNTING_PERIOD
	, PS_LEDGER.POSTED_TOTAL_AMT
	, PS_LEDGER.LEDGER
	, PS_Ledger.DTTM_STAMP_SEC
FROM ctcLink_ODS.SYSADM_FIN.PS_LEDGER PS_Ledger
WHERE (FISCAL_YEAR = @FY OR FISCAL_YEAR = @FY - 1) AND LEDGER = @LEDGER AND ACCOUNTING_PERIOD <= @MAX_FM

UNION

SELECT
	CASE
		WHEN FUND_CODE = '057' AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4100050 AND 4100059  THEN 'Line 21 - Capital Appropriations'
		WHEN FUND_CODE = '060' AND LEN(PRODUCT) <> 0 AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4100050 AND 4100059  THEN 'Line 21 - Capital Appropriations'
		WHEN FUND_CODE = '057' AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4200010 AND 4200099  THEN 'Line 21 - Capital Appropriations'
		WHEN FUND_CODE = '060' AND LEN(PRODUCT) <> 0 AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4200010 AND 4200099  THEN 'Line 21 - Capital Appropriations'

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4210010 AND 4210099  THEN 'Line 21A - Capital Gifts and Grants'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4220010 AND 4220099  THEN 'Line 21A - Capital Gifts and Grants'
	END Category
	, CASE
		WHEN FUND_CODE = '057' AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4100050 AND 4100059  THEN 'Capital Appropriations'
		WHEN FUND_CODE = '060' AND LEN(PRODUCT) <> 0 AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4100050 AND 4100059  THEN 'Capital Appropriations'
		WHEN FUND_CODE IN ('057', '060') AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4200010 AND 4200099  THEN 'Capital Appropriations'
		WHEN FUND_CODE = '060' AND LEN(PRODUCT) <> 0 AND CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4200010 AND 4200099  THEN 'Capital Appropriations'

		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4210010 AND 4210099  THEN 'Capital Gifts and Grants'
		WHEN CAST(PS_Ledger.ACCOUNT AS INT) BETWEEN 4220010 AND 4220099  THEN 'Capital Gifts and Grants'
	END [Sub-Category]
	, PS_Ledger.FUND_CODE
	, PS_LEDGER.PRODUCT
	, PS_LEDGER.CLASS_FLD
	, PS_LEDGER.DEPTID
	, PS_LEDGER.ACCOUNT
	, PS_LEDGER.FISCAL_YEAR
	, PS_LEDGER.ACCOUNTING_PERIOD
	, PS_LEDGER.POSTED_TOTAL_AMT
	, PS_LEDGER.LEDGER
	, PS_Ledger.DTTM_STAMP_SEC
FROM ctcLink_ODS.SYSADM_FIN.PS_LEDGER PS_Ledger
WHERE (FISCAL_YEAR = @FY OR FISCAL_YEAR = @FY - 1) AND LEDGER = @LEDGER
	AND ACCOUNTING_PERIOD <= @MAX_FM
	AND PRODUCT NOT IN ('CRS','CRI')
) q
WHERE Category IS NOT NULL
	AND (FISCAL_YEAR = @FY OR FISCAL_YEAR = @FY - 1)
	AND LEDGER = @LEDGER
	AND ACCOUNTING_PERIOD <= @MAX_FM

-- All Data, line by line
SELECT * FROM #PS_LEDGER_W_SRECNP_DESCR
ORDER BY FISCAL_YEAR, CATEGORY, [Sub-Category], ACCOUNTING_PERIOD;

-- Breakdown by SRECNP Category
SELECT Category, SUM(CASE FISCAL_YEAR WHEN @FY THEN POSTED_TOTAL_AMT ELSE 0 END) FY_TOTAL, SUM(CASE FISCAL_YEAR WHEN @FY - 1 THEN POSTED_TOTAL_AMT ELSE 0 END) PREV_FY_TOTAL
FROM #PS_LEDGER_W_SRECNP_DESCR
GROUP BY Category
ORDER BY Category

-- If a category is missing then there is no data for the relevant accounts
